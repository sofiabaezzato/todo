import { clearElement } from "./cards"

const listContainer = document.querySelector('.project-menu')
const newProjectForm = document.querySelector('[data-new-project-form]')
const newProjectInput = document.querySelector('[data-new-project-input]')

const LOCAL_STORAGE_PROJECT_KEY = 'task.projects'
const LOCAL_STORAGE_SELECTED_PROJECT_ID_KEY = 'task.selectedProjectId'
let projects = JSON.parse(localStorage.getItem(LOCAL_STORAGE_PROJECT_KEY)) || []
let selectedProjectId = localStorage.getItem(LOCAL_STORAGE_SELECTED_PROJECT_ID_KEY)

listContainer.addEventListener('click', e => {
    if(e.target.className === 'list-name') {
        selectedProjectId = e.target.dataset.projectId
        saveAndRenderProjects()
    }
})

newProjectForm.addEventListener('submit', e => {
    e.preventDefault()
    const projectName = newProjectInput.value
    if (projectName == null || projectName === '') return
    const project = createProject(projectName)
    newProjectInput.value = null
    projects.push(project)
    saveAndRenderProjects()
})

listContainer.addEventListener('click', e => {
    console.log(e)
    if(e.target.className === 'remove-project-btn') {
        console.log(e.target)
        let projectId = e.target.dataset.projectId
        projects = projects.filter(project => project.id != projectId)
        saveAndRenderProjects()
    }
})

function createProject(name) {
    return { id: new Date().valueOf().toString(), name: name, tasks:[]}
}

function saveAndRenderProjects() {
    saveProjects()
    renderProjects()
}

function saveProjects() {
    localStorage.setItem(LOCAL_STORAGE_PROJECT_KEY, JSON.stringify(projects))
    localStorage.setItem(LOCAL_STORAGE_SELECTED_PROJECT_ID_KEY, selectedProjectId)
}

function renderProjects() {
    clearElement(listContainer)
    projects.forEach(project => {
        const listElement = document.createElement('li')
        listElement.dataset.projectId = project.id
        listElement.classList.add('list-name')
        listElement.textContent = project.name
        if (project.id === selectedProjectId) {
            listElement.classList.add('active-list')
        }
        const removeProjectBtn = document.createElement('img')
        removeProjectBtn.classList.add('remove-project-btn')
        removeProjectBtn.src = "../src/img/minus-solid.svg"
        removeProjectBtn.dataset.projectId = project.id
        listElement.appendChild(removeProjectBtn)
        listContainer.appendChild(listElement)
    })
}






export { renderProjects }